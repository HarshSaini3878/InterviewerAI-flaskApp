<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Chatbot</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="{{ url_for('static', filename='/scripts/script.js') }}"></script>
    </head>
    <body>
        <div class="container">
            <div class="top-container">
                <div class="webcam-container"> 
                    <video id="video" width="640" height="480" autoplay muted></video>
                    <button id="startRecording">Start Recording</button>
                    <button id="hangup">Stop Recording and Save</button>
                </div>
                <div class="left-container">
                    <div id="chat-container"></div>
                    <div id="input-container">
                        <textarea id="user-response" placeholder="Reply to Friday..."></textarea>
                        <button id="submit-response" class="chat-btn">âžœ</button>
                    </div>
                    <div id="controls">
                        <button id="toggle-mic">Mic</button>
                        <button id="toggle-camera">Camera</button>
                        <button id="clear-chat-history">End</button>
                    </div>
                    <div id="upload-container">
                        <form id="upload-form" action="{{ url_for('upload_file') }}" method="post" enctype="multipart/form-data">
                            <input type="file" name="resume" id="resume" required>
                            <input type="submit" value="Upload Resume" class="upload-btn" onclick="return checkFileSelected()">
                        </form>
                        <p id="upload-message" style="display: none; color: green;"></p>
                    </div>
                </div>
            </div>
            <div class="right-container">
                <div id="interim-transcript"></div>
                <br>
                <div class="transcript-header">
                    <h2>Transcript</h2>
                    <button id="startButton">transcript</button>
            </div>
            <div id="transcript" class="transcript-content"> 
                <p>Transcript will appear here...</p>
                <p>This is example text, a lot of transcription text will be printed here. </p>
            </div>
        </div>
    </div>    
    <div id="output"></div>

    
    <script src="{{ url_for('static', filename='/scripts/webcam.js') }}"></script>
    <script src="{{ url_for('static', filename='/scripts/transcript.js') }}"></script>


    <audio id="audio" controls autoplay></audio>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.2/socket.io.js"></script>
    <script>
        const audio = document.getElementById('audio');
        const socket = io.connect('http://' + document.domain + ':' + location.port);

        socket.on('connect', function() {
            socket.emit('request_audio');
        });

        socket.on('audio_data', function(data) {
            const chunk = data['chunk'];
            const byteArray = new Uint8Array(chunk);
            const blob = new Blob([byteArray], { type: 'audio/mpeg' });
            const blobURL = URL.createObjectURL(blob);
            audio.src = blobURL;
        });
    </script>
</body>
</html>
